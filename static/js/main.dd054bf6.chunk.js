(this.webpackJsonpglimmer=this.webpackJsonpglimmer||[]).push([[0],{12:function(e,t,n){},22:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var r=n(0),a=n.n(r),o=n(4),c=n(5),s=n(11),i=n.n(s),u=function t(){var n=this;Object(c.a)(this,t),this.nextIndex=void 0,this.screenList=void 0,this.updatePeriod=void 0,this.nullCount=void 0,this.intervalTimer=void 0,this.screenListUrl="http://glimmerhub.com/config/screen-list.json",this.start=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getScreenList();case 2:n.update(),n.intervalTimer=setInterval(n.update,6e4);case 4:case"end":return e.stop()}}),e)}))),this.getScreenList=Object(o.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.a.get(n.screenListUrl);case 3:t=e.sent,n.screenList=t.data.screens,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("Sequence::getScreenList failed to get data ".concat(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),this.update=Object(o.a)(a.a.mark((function t(){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("Sequence::update - **********************  Starting  *********************"),r=(new Date).getTime(),n.screenList.forEach(function(){var t=Object(o.a)(a.a.mark((function t(n){var o,c,s,u,l;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("Sequence::update: Checking: ".concat(n.resource)),!("undefined"===typeof n.nextUpdate||n.nextUpdate<r)){t.next=10;break}return console.log("Sequence::update: Time to update: ".concat(n.resource)),t.next=5,i()({url:n.resource,method:"get",responseType:"arraybuffer"});case 5:o=t.sent,console.log("Sequence::update: ".concat(n.resource," GET status: ").concat(o.status)),200!==o.status?n.image=null:(c=e.from(o.data,"binary").toString("base64"),s="/"===c.charAt(0)?"jpeg":"i"===c.charAt(0)?"png":"R"===c.charAt(0)?"gif":"U"===c.charAt(0)?"webp":"",(u=new Image).onload=function(){console.log("Sequence::update: ".concat(n.resource," image.onload")),n.image=u},u.onerror=function(){console.error("Sequence::update: ".concat(n.resource," image.onerror")),n.image=null},l="data:image/"+s+";base64,"+c,u.src=l,n.nextUpdate=r+3600*n.refreshMinutes,console.log("Sequence::update Updated next update to ".concat(n.nextUpdate)),console.log("Sequence::update (update-time - now)/60 seconds ".concat((n.nextUpdate-r)/60))),t.next=11;break;case 10:console.log("Sequence::update: ".concat(n.resource," up-to-date"));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t)}))),this.getNext=function(){var e=n.screenList[n.nextIndex];if(null===e.image&&n.nullCount<2?n.nullCount++:n.nextIndex++,null===e.image){console.log("Sequence::getNext: returning null image with 1 sec duration");return{image:null,displaySecs:5,nextUpdate:0,refreshMinutes:0,resource:""}}return n.nextIndex>=n.screenList.length&&(n.nextIndex=0),console.log("Sequence::getNext: resource: ".concat(e.resource,' non-null"}')),e},this.nextIndex=0,this.screenList=[],this.updatePeriod=60,this.nullCount=0,this.screenList=JSON.parse('{"screens" : [{"resource": "https://i.imgur.com/Whf10Sd.png", "refreshMinutes": 60, "displaySecs": 6}]}')}}).call(this,n(30).Buffer)},55:function(e,t,n){"use strict";n.r(t);var r=n(3),a=n.n(r),o=n(21),c=n.n(o),s=n(5),i=n(6),u=n(8),l=n(7),d=(n(12),n(0)),m=n.n(d),g=n(4),h=n(2),f=n(29),p=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).currentImage=void 0,r.props=void 0,r.componentDidUpdate=function(e){r.showImage(r.props.image)},r.showImage=function(){var e=Object(g.a)(m.a.mark((function e(t){var n,a,o,c,s,i,u,l,d,g;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof t||null===t){e.next=32;break}if(console.log("Canvas::showImage showing image (".concat(r.props.name,").")),null!==(n=document.getElementById("myCanvas"))){e.next=6;break}return console.log('Canvas:: showImage() - "myCanvas" element was null'),e.abrupt("return");case 6:if(n.width=window.innerWidth,n.height=window.innerHeight,null!==(a=n.getContext("2d"))){e.next=12;break}return console.log("Canvas:: showImage() - Failed to get CanvasRenderingContext2D from canvas"),e.abrupt("return");case 12:if(o=t.width/t.height,c=n.width,(s=c/o)>n.height&&(s=n.height,c=s*o),i=0,u=0,c<n.width&&(i=(n.width-c)/2),s<n.height&&(u=(n.height-s)/2),console.log("before"),null===r.currentImage){e.next=24;break}return e.next=24,r.fadeOutImage(a,r.currentImage,i,u,c,s);case 24:return console.log("middle"),a.clearRect(0,0,n.width,n.height),e.next=28,r.fadeInImage(a,t,i,u,c,s);case 28:console.log("end"),r.currentImage=t,e.next=46;break;case 32:if(console.log("Canvas::showImage is null or undefined, user sees the time."),(l=document.getElementById("myCanvas")).width=window.innerWidth,l.height=window.innerHeight,null!==(d=l.getContext("2d"))){e.next=40;break}return console.log("Canvas:: showImage() - Failed to get CanvasRenderingContext2D from canvas"),e.abrupt("return");case 40:d.fillStyle="#003399",d.fillRect(0,0,l.width,l.height),g=new Date,d.fillStyle="red",d.font="80pt Arial bold",d.fillText(f(g,"h:MM TT"),l.width/2-300,l.height/2);case 46:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.props=e,r.currentImage=null,r}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.showImage(this.props.image)}},{key:"componentWillUnmount",value:function(){}},{key:"fadeInImage",value:function(e,t,n,r,a,o){return new Promise((function(c,s){console.log("fadeInImage start");var i=0;!function s(){(i+=.05)<1?(e.globalAlpha=i,e.drawImage(t,n,r,a,o),requestAnimationFrame(s)):(console.log("fadeInImage done"),c())}()}))}},{key:"fadeOutImage",value:function(e,t,n,r,a,o){return new Promise((function(c,s){console.log("fadeOutImage start");var i=1;!function s(){(i-=.05)>0?(e.globalAlpha=i,e.drawImage(t,n,r,a,o),requestAnimationFrame(s)):(console.log("fadeOutImage done"),c())}()}))}},{key:"render",value:function(){return console.log("MyCanvas::render"),Object(h.jsx)("canvas",{id:"myCanvas"})}}]),n}(a.a.Component),v=n(22),x=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).sequence=void 0,r.timeout=void 0,r.showNextScreen=function(){console.log("ViewerScreen::showNextScreen");var e=r.sequence.getNext();r.setState({image:e.image,name:e.resource,displayTime:e.displaySecs}),r.timeout=setTimeout((function(){console.log("ViewerScreen::showNextScreen - setting timeout for ".concat(r.state.displayTime," secs")),r.showNextScreen()}),1e3*r.state.displayTime)},r.handleClick=function(e){console.log("Viewer::onClick",e.button),r.isInFullScreen()?r.openFullscreen():r.closeFullscreen()},r.isInFullScreen=function(){return document.fullscreenElement&&null!==document.fullscreenElement},r.openFullscreen=function(){var e=document.documentElement;console.dir(e),e.requestFullscreen&&e.requestFullscreen()},r.closeFullscreen=function(){document.exitFullscreen&&document.exitFullscreen()},r.sequence=new v.a,r.state={image:null,name:"null",displayTime:0},r.timeout=null,r}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=Object(g.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sequence.start();case 2:this.showNextScreen();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}},{key:"render",value:function(){return console.log("Viewer::render"),Object(h.jsx)("div",{id:"myViewer",className:"Viewer",children:Object(h.jsx)(p,{image:this.state.image,name:this.state.name})})}}]),n}(a.a.Component),w=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={publicUrlPrefix:""},r}return Object(i.a)(n,[{key:"render",value:function(){return Object(h.jsx)("div",{children:Object(h.jsx)(x,{})})}}]),n}(a.a.Component);n(54);c.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(w,{})}),document.getElementById("root"))}},[[55,1,2]]]);
//# sourceMappingURL=main.dd054bf6.chunk.js.map